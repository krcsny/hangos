{
  "version": 3,
  "file": "script.js",
  "sourceRoot": "",
  "sources": [
    "script.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nPlayer = new Tone.Player().toMaster()\n\nMic = new Tone.UserMedia()\n\nVisual = \n  mode : \"wave\" # \"wave\"\n  waveform : null\n  micform : null\n  ctx : null\n  hsl : (h, s, l, a) -> \n   \"hsl(#{h * 360}, #{s * 100}%, #{l * 100}%, #{a})\"\n  loops : (w, h) ->\n    sw = w / 3\n    sh = h / 3\n    for l in [0..8]\n      @ctx.fillStyle = \n        if Looper.tracks[l].player.mute\n          \"#6244\"\n        else\n          @hsl 0.9 + Math.random() * 0.2, 0.8 + Math.random() * 0.1, 0.3, 0.2 + Math.random() * 0.2\n      @ctx.fillRect((l % 3) * sw, Math.floor(l / 3) * sh, sw, sh)\n  drawWaveform : (values) ->\n    w = @ctx.canvas.width\n    h =  @ctx.canvas.height\n    # @ctx.clearRect(0, 0, w, h)\n    @ctx.fillStyle = \"#6244\"\n    @ctx.fillRect(0, 0, w, h)\n    if Map.current? and Map.current.isLooper()\n      @loops w, h\n    @ctx.lineJoin = \"bezel\"\n\n    @ctx.strokeStyle = @hsl 0.9 + Math.random() * 0.2, 0.8 + Math.random() * 0.1, 0.5, 0.5 # \"d48\"\n    @ctx.lineWidth = 1 + values[0] * (15 + Math.random() * 5)\n    @ctx.beginPath()\n    @ctx.moveTo(0, 0.5 * h)\n    # console.log values\n    for v, i in values\n      x = (i / values.length) * w\n      y = ((v + 1) / 2) * 2 * h - h * 0.5\n      @ctx.lineTo(x, y)\n    @ctx.lineTo(w, 0.5 * h)\n    @ctx.stroke()\n      \n    # segment = 128\n    # for part in [0..7]\n    #   @ctx.lineWidth = 1 + values[0] * (15 + Math.random() * 5)\n    #   @ctx.strokeStyle = @hsl 0.9 + Math.random() * 0.2, 0.8 + Math.random() * 0.1, 0.5, 0.5 # \"d48\"\n    #   @ctx.beginPath()\n    #   @ctx.moveTo(0, 0.5 * h)\n    #   for i in [0..segment - 1]    \n    #     val = (values[part * segment + i] + 1) / 2\n    #     x = w * ((i % segment) / segment)\n    #     y = val * 2 * h - h * 0.5\n    #     @ctx.lineTo(x, y)\n    #   @ctx.lineTo(w, 0.5 * h)\n    #   @ctx.stroke()\n  draw : () ->\n    @drawWaveform( if Recorder.recording then @micform.getValue() else @waveform.getValue());\n    requestAnimationFrame(Visual.draw.bind(Visual));\n  write : (text) ->\n    # if @mode is \"text\"\n    $(\"#text\").html text\n  resize : () ->\n    @ctx.canvas.width = $(\"#screen\").width()\n    @ctx.canvas.height = $(\"#screen\").height()\n  init : () ->\n    if @mode is \"wave\"\n      @waveform = new Tone.Waveform(256)\n      @micform = new Tone.Waveform(256)\n      Tone.Master.fan @waveform\n      Mic.connect @micform\n      @ctx = $(\"canvas\").get(0).getContext(\"2d\")\n      $(window).resize Visual.resize.bind(Visual)\n      @resize()\n      @draw()\n\nSlots = 6\n\nRecorder = \n  recording : false\n  rec : null\n  audioChunks : []\n  audio : null\n  url : null\n  slots : []\n  currentSlot : 0\n  init : () ->\n    @slots = \n      for s in [0..Slots - 1]\n        new Tone.Player().toMaster()\n  stop : () -> @rec.stop()\n\n  pushdata : (e) ->\n    @audioChunks.push(e.data)\n  convertData : () ->\n    console.log \"stopped recording\"\n    audioBlob = new Blob(@audioChunks)\n    @url = URL.createObjectURL(audioBlob)\n    # @audio = new Audio(@url)\n    @ready @url\n    @recording = false\n    # audio.play()\n    \n  record : (mic) ->\n    stream = mic._stream\n    @recording = true\n    console.log \"started recording\"\n    @audioChunks = []\n    @rec = new MediaRecorder stream\n    @rec.start()\n\n    @audioChunks = []\n    @rec.addEventListener(\"dataavailable\", @pushdata.bind(@))\n\n    @rec.addEventListener(\"stop\", @convertData.bind(@))\n\n    # setTimeout((() -> Recorder.rec.stop()),3000)\n  start : () ->\n    Mic.open().then(@record.bind(@))\n    # navigator.mediaDevices.getUserMedia({ audio: true })\n      # .then(@record.bind(Recorder))\n\n  ready : (url) ->\n    # console.log @audio\n    console.log \"setting buffer\"\n    new Tone.Buffer(url, @bufferReady.bind(@))\n  bufferReady : (b) ->\n    @slots[@currentSlot].buffer = b\n\n  togglePlayer : (e) ->\n    s = $(e.currentTarget).parent().index()\n    @slots[s].start()\n\n  toggleRecord : (e) ->\n    s = $(e.currentTarget).parent().index()\n    if @recording\n      @stop()\n\n    if s isnt @currentSlot or not @recording\n      @currentSlot = s\n      @start()\n\n\n\ninit = () ->\n  slots = \n    for s in [0..Slots - 1]\n      record = $(\"<button>\", \n        html : \"R\"\n        click : Recorder.toggleRecord.bind(Recorder)\n      )\n      play = $(\"<button>\", \n        html : \"P\"\n        click : Recorder.togglePlayer.bind(Recorder)\n      )\n      \n      buttons = [record, play]\n      $(\"<div>\",\n        class : \"button-row\"\n        html : buttons\n      )\n\n  $(\"#buttons\").html slots\n\n  Visual.init()\n  Recorder.init()\n\n\ninit()\n"
  ]
}