{
  "version": 3,
  "file": "script.js",
  "sourceRoot": "",
  "sources": [
    "script.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nPlayer = new Tone.Player().toMaster()\n\nMic = new Tone.UserMedia()\n\nVisual = \n  mode : \"wave\" # \"wave\"\n  waveform : null\n  micform : null\n  ctx : null\n  hsl : (h, s, l, a) -> \n   \"hsl(#{h * 360}, #{s * 100}%, #{l * 100}%, #{a})\"\n  loops : (w, h) ->\n    sw = w / 3\n    sh = h / 3\n    for l in [0..8]\n      @ctx.fillStyle = \n        if Looper.tracks[l].player.mute\n          \"#6244\"\n        else\n          @hsl 0.9 + Math.random() * 0.2, 0.8 + Math.random() * 0.1, 0.3, 0.2 + Math.random() * 0.2\n      @ctx.fillRect((l % 3) * sw, Math.floor(l / 3) * sh, sw, sh)\n  drawWaveform : (values) ->\n    w = @ctx.canvas.width\n    h =  @ctx.canvas.height\n    # @ctx.clearRect(0, 0, w, h)\n    @ctx.fillStyle = \"#6244\"\n    @ctx.fillRect(0, 0, w, h)\n    if Map.current? and Map.current.isLooper()\n      @loops w, h\n    @ctx.lineJoin = \"bezel\"\n\n    @ctx.strokeStyle = @hsl 0.9 + Math.random() * 0.2, 0.8 + Math.random() * 0.1, 0.5, 0.5 # \"d48\"\n    @ctx.lineWidth = 1 + values[0] * (15 + Math.random() * 5)\n    @ctx.beginPath()\n    @ctx.moveTo(0, 0.5 * h)\n    # console.log values\n    for v, i in values\n      x = (i / values.length) * w\n      y = ((v + 1) / 2) * 2 * h - h * 0.5\n      @ctx.lineTo(x, y)\n    @ctx.lineTo(w, 0.5 * h)\n    @ctx.stroke()\n  draw : () ->\n    @drawWaveform( if Recorder.recording then @micform.getValue() else @waveform.getValue());\n    requestAnimationFrame(Visual.draw.bind(Visual));\n  write : (text) ->\n    # if @mode is \"text\"\n    $(\"#text\").html text\n  resize : () ->\n    @ctx.canvas.width = $(\"#screen\").width()\n    @ctx.canvas.height = $(\"#screen\").height()\n  init : () ->\n    if @mode is \"wave\"\n      @waveform = new Tone.Waveform(256)\n      @micform = new Tone.Waveform(256)\n      Tone.Master.fan @waveform\n      Mic.connect @micform\n      @ctx = $(\"canvas\").get(0).getContext(\"2d\")\n      $(window).resize Visual.resize.bind(Visual)\n      @resize()\n      @draw()\n\nSlots = 6\n\nRecorder = \n  recording : false\n  rec : null\n  audioChunks : []\n  audio : null\n  url : null\n  slots : []\n  currentSlot : 0\n  effects : [\n    Tone.Master\n    new Tone.PitchShift(-7).toMaster()\n    new Tone.PitchShift(12).toMaster()\n    new Tone.BitCrusher(3).toMaster()\n  ]\n  effectSigns : [\"_\", \"v\", \"^\", '#']\n  init : () ->\n    @slots = \n      for s in [0..Slots - 1]\n        sl = new Tone.Player().toMaster()\n        sl.effect = 0\n        sl\n  stop : () -> @rec.stop()\n\n  pushdata : (e) ->\n    @audioChunks.push(e.data)\n  convertData : () ->\n    console.log \"stopped recording\"\n    audioBlob = new Blob(@audioChunks)\n    @url = URL.createObjectURL(audioBlob)\n    # @audio = new Audio(@url)\n    @ready @url\n    @recording = false\n    # audio.play()\n    \n  record : (mic) ->\n    stream = mic._stream\n    @recording = true\n    console.log \"started recording\"\n    @audioChunks = []\n    @rec = new MediaRecorder stream\n    @rec.start()\n\n    @audioChunks = []\n    @rec.addEventListener(\"dataavailable\", @pushdata.bind(@))\n\n    @rec.addEventListener(\"stop\", @convertData.bind(@))\n\n    # setTimeout((() -> Recorder.rec.stop()),3000)\n  start : () ->\n    Mic.open().then(@record.bind(@))\n    # navigator.mediaDevices.getUserMedia({ audio: true })\n      # .then(@record.bind(Recorder))\n\n  ready : (url) ->\n    # console.log @audio\n    console.log \"setting buffer\"\n    new Tone.Buffer(url, @bufferReady.bind(@))\n  bufferReady : (b) ->\n    @slots[@currentSlot].buffer = b\n    if @slots[@currentSlot].cue \n      @slots[@currentSlot].cue = false\n      @togglePlayer @currentSlot\n\n  togglePlayer : (s) ->\n    if Recorder.slots[s].buffer.loaded\n      if @slots[s].state is \"started\"\n        @slots[s].stop()\n        \"||\"\n      else \n        @slots[s].start()\n        \"|>\"\n    else if @recording and @currentSlot is s\n      s.cue = true\n      @stop()\n      \"||\"\n\n  toggleLooping : (s) ->\n    @slots[s].loop = not @slots[s].loop\n\n  toggleRecord : (e) ->\n    s = $(e.currentTarget).parent().index()\n    if @recording\n      setbuttons @currentSlot, \"show\"\n      @stop()\n\n    if s isnt @currentSlot or not @recording\n      $($($(\"#buttons\").children()[@currentSlot]).children()[0]).removeClass \"current\"\n      @currentSlot = s\n      $($($(\"#buttons\").children()[s]).children()[0]).addClass \"current\"\n      setbuttons @currentSlot, \"hide\"\n      @start()\n\n  cycleEffect : (s) ->\n    @slots[s].disconnect @effects[@slots[s].effect]\n    @slots[s].effect = (@slots[s].effect + 1) % @effects.length\n    @slots[s].connect @effects[@slots[s].effect]\n\n\n\n\nsetbuttons = (s, show) ->\n  for ss in [0..Slots-1]\n    if ss isnt s\n      $($(\"#buttons\").children()[ss])[show]()\n  for x in [1..4]\n    $($($(\"#buttons\").children()[s]).children()[x])[show]()\n    # $(\"#buttons:nth-child(#{s}):nth-child(#{x})\").hide()\n\ncheckstates = () ->\n  for s in [0..Slots-1]\n    $($($(\"#buttons\").children()[s]).children()[1]).html(if Recorder.slots[s].state is \"started\" then \"&#x25a0;\" else if Recorder.slots[s].buffer.loaded then \"&#x25b6;\" else \"&empty;\")\n\n\ninit = () ->\n  slots = \n    for s in [0..Slots - 1]\n      record = $(\"<button>\", \n        html : \"&#x25cf;\"\n        class :\"numpad\"\n        click : Recorder.toggleRecord.bind(Recorder)\n      )\n      play = $(\"<button>\", \n        html : \"\"\n        class :\"numpad\"\n        click : (e) ->\n          s = $(e.currentTarget).parent().index()\n          Recorder.togglePlayer(s)\n      )\n      looper = $(\"<button>\", \n        html : \"1\"\n        class :\"numpad\"\n        click : (e) ->\n          s = $(e.currentTarget).parent().index()\n          Recorder.toggleLooping(s)\n          $(@).html(if Recorder.slots[s].loop then \"&infin;\" else \"1\")\n      )\n      fx = $(\"<button>\", \n        html : \"_\"\n        class :\"numpad\"\n        click : (e) ->\n          s = $(e.currentTarget).parent().index()\n          Recorder.cycleEffect(s)\n          $(@).html(Recorder.effectSigns[Recorder.slots[s].effect])\n      )\n      buttons = [record, play, looper, fx]\n      $(\"<div>\",\n        class : \"buttonrow\"\n        html : buttons\n      )\n\n  $(\"#buttons\").html slots\n\n  Visual.init()\n  Recorder.init()\n  setInterval(checkstates, 100)\n\ninit()\n"
  ]
}