{
  "version": 3,
  "file": "script.js",
  "sourceRoot": "",
  "sources": [
    "script.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "\nPlayer = new Tone.Player().toMaster()\n\nMic = new Tone.UserMedia()\n\nVisual = \n  mode : \"wave\" # \"wave\"\n  waveform : null\n  micform : null\n  ctx : null\n  hsl : (h, s, l, a) -> \n   \"hsl(#{h * 360}, #{s * 100}%, #{l * 100}%, #{a})\"\n  slots : (w, h) ->\n    sw = w / Slots\n    hw = sw * 0.5\n    for s in [0..Slots-1]\n      if Recorder.slots[s]? and Recorder.slots[s].state is \"started\"\n        @ctx.fillStyle = @hsl 0.9 + Math.random() * 0.2, 0.8 + Math.random() * 0.1, 0.3, 0.2 + Math.random() * 0.2\n        @ctx.fillRect(s * sw, 0, sw, h)\n        y = (1 - (Recorder.getEffectValue s)) * h\n        @ctx.fillStyle = \"#0004\"\n        @ctx.beginPath()\n        @ctx.arc(s * sw + hw, y, hw, 0, 2 * Math.PI)\n        @ctx.fill()\n  drawWaveform : (values) ->\n    w = @ctx.canvas.width\n    h =  @ctx.canvas.height\n    # @ctx.clearRect(0, 0, w, h)\n    @ctx.fillStyle = if MasterRecorder? and MasterRecorder.isRecording() then \"#F55D3E22\" else \"#76BED0\"\n    @ctx.fillRect(0, 0, w, h)\n    @slots w, h\n    @ctx.lineJoin = \"bezel\"\n\n    @ctx.strokeStyle = \"#000\"\n    @ctx.lineWidth = 1 + values[0] * (15 + Math.random() * 5)\n    @ctx.beginPath()\n    @ctx.moveTo(0, 0.5 * h)\n    # console.log values\n    for v, i in values\n      x = (i / values.length) * w\n      y = ((v + 1) / 2) * 2 * h - h * 0.5\n      @ctx.lineTo(x, y)\n    @ctx.lineTo(w, 0.5 * h)\n    @ctx.stroke()\n  draw : () ->\n    @drawWaveform( if Recorder.recording then @micform.getValue() else @waveform.getValue());\n    requestAnimationFrame(Visual.draw.bind(Visual));\n  write : (text) ->\n    # if @mode is \"text\"\n    $(\"#text\").html text\n  resize : () ->\n    @ctx.canvas.width = $(\"#screen\").width()\n    @ctx.canvas.height = $(\"#screen\").height()\n  init : () ->\n    if @mode is \"wave\"\n      @waveform = new Tone.Waveform(256)\n      @micform = new Tone.Waveform(256)\n      Tone.Master.fan @waveform\n      Mic.connect @micform\n      @ctx = $(\"canvas\").get(0).getContext(\"2d\")\n      $(window).resize Visual.resize.bind(Visual)\n      @resize()\n      @draw()\n\nSlots = 6\n\nFX = \n  names : [\n    \"Tone\"\n    \"PitchShift\"\n    \"Freeverb\"\n    \"Chorus\"\n    \"PingPongDelay\"\n    \"BitCrusher\"\n    \"Distortion\"\n    \"Reverse\"\n  ]\n  create : (i, parent) ->\n    r = null\n    name = @names[i]\n    switch name\n      when \"Tone\"\n        r = new Tone.Limiter(0).toMaster()\n        r.sign = \"%\"\n        r.parent = parent\n        r.getVal = () ->\n          if r.parent? \n            Math.sqrt(parent.playbackRate / 6)\n          else\n            -1\n        r.setVal = (y) ->\n          if r.parent? \n            parent.set \"playbackRate\", 0.1 + y * y * 6\n\n      when \"PitchShift\"\n        r = new Tone.PitchShift(-6).toMaster()\n        r.sign = \"*\"\n        r.getVal = () ->\n          (10 + @pitch) / 36\n        r.setVal = (y) ->\n          r.set \"pitch\", -10 + 36 * y\n\n      when \"Freeverb\"\n        r = new Tone.Freeverb().toMaster()\n        r.sign = \"&sum;\"\n        r.getVal = () ->\n          (@roomSize.value - 0.5) / 0.45\n        r.setVal = (y) ->\n          r.set \"roomSize\", 0.5 + 0.45 * y\n\n      when \"Chorus\"\n        r = new Tone.Chorus().toMaster()\n        r.sign = \"~\"\n        r.getVal = () ->\n          (@depth - 0.7) / 0.3\n          # 1 - ((10 + @pitch) / 24)\n        r.setVal = (y) ->\n          @set \"frequency\", 0.1 + y * 50\n          @depth = 0.7 + 0.3 * y\n          # @delayTime = 1 + 9 * y\n\n      when \"Phaser\"\n        r = new Tone.Phaser().toMaster()\n        r.sign = \"~\"\n        r.getVal = () ->\n          @depth\n        r.setVal = (y) ->\n          @set \"frequency\", 0.5 + y * 99.5\n          @depth = 0.1 + 0.7 * y\n\n      when \"PingPongDelay\"\n        r = new Tone.PingPongDelay().toMaster()\n        r.sign = \":\"\n        r.getVal = () ->\n          @delayTime.value\n          # 1 - ((10 + @pitch) / 24)\n        r.setVal = (y) ->\n          r.set \"maxDelay\", y\n          r.set \"delayTime\", y\n\n      when \"BitCrusher\"\n        r = new Tone.BitCrusher(5).toMaster()\n        r.sign = \"#\"\n        r.getVal = () ->\n          1 - ((@bits - 3) / 3)\n        r.setVal = (y) ->\n          @set \"bits\", 6 - Math.round(y * 3)\n\n      when \"Distortion\"\n        r = new Tone.Distortion().toMaster()\n        r.sign = \"!\"\n        r.getVal = () ->\n          @distortion\n        r.setVal = (y) ->\n          @set \"distortion\", y\n\n      when \"Reverse\"\n        r = new Tone.Limiter(0).toMaster()\n        r.sign = \"<\"\n        r.getVal = () -> -1\n        r.setVal = () ->\n    r.index = i\n    r\n    \nMath.clamp = (x, min, max) ->\n  Math.min(Math.max(x, min), max)\n\nMasterRecorder = null\n\nRecorder = \n  muteOnRec : false\n  recording : false\n  rec : null\n  audioChunks : []\n  audio : null\n  url : null\n  slots : []\n  currentSlot : 0\n  # effects : [\n  #   Tone.Master\n  #   new Tone.PitchShift(-7).toMaster()\n  #   new Tone.PitchShift(12).toMaster()\n  #   new Tone.BitCrusher(3).toMaster()\n  # ]\n  init : () ->\n    @slots = \n      for s in [0..Slots - 1]\n        slot = new Tone.Player()\n        slot.effect = FX.create 0, slot\n        slot.connect slot.effect\n        slot.loop = true\n        slot\n  stop : () -> @rec.stop()\n\n  pushdata : (e) ->\n    @audioChunks.push(e.data)\n  convertData : () ->\n    console.log \"stopped recording\"\n    audioBlob = new Blob(@audioChunks)\n    @url = URL.createObjectURL(audioBlob)\n    # @audio = new Audio(@url)\n    @recording = false\n    @ready @url\n    # audio.play()\n    \n  record : (mic) ->\n    stream = mic._stream\n    @recording = true\n    console.log \"started recording\"\n    @audioChunks = []\n    @rec = new MediaRecorder stream\n    @rec.start()\n\n    @audioChunks = []\n    @rec.addEventListener(\"dataavailable\", @pushdata.bind(@))\n\n    @rec.addEventListener(\"stop\", @convertData.bind(@))\n\n    # setTimeout((() -> Recorder.rec.stop()),3000)\n  start : () ->\n    Mic.open().then(@record.bind(@))\n    Tone.Master.mute = @muteOnRec\n    # navigator.mediaDevices.getUserMedia({ audio: true })\n      # .then(@record.bind(Recorder))\n\n  saveFile : (blob) ->\n    a = $(\"<a style='display: none;'/>\")\n    # blob = new Blob(@audioChunks, {type: 'audio/ogg; codecs=opus'})\n    url = window.URL.createObjectURL(blob)\n    a.attr(\"href\", url)\n    date = new Date()\n    name = \"hangos \" + date.toTimeString().substr(0,9).replace(/:/g, \"-\") + date.getDate() + \"/\" + date.getMonth() + \"/\" + date.getFullYear() \n    a.attr(\"download\", name)\n    $(\"body\").append(a)\n    a[0].click()\n    window.URL.revokeObjectURL(url)\n    a.remove()\n    \n  ready : (url, blob) ->\n    # console.log @audio\n    # if @currentSlot is -1\n    console.log \"setting buffer\"\n    new Tone.Buffer(url, @bufferReady.bind(@))\n  bufferReady : (b) ->\n    slot = @slots[@currentSlot]\n    slot.buffer = b\n    slot.buffer.reverse = slot.effect.sign is \"<\"\n    @togglePlayer @currentSlot\n    Tone.Master.mute = false\n\n  togglePlayer : (s) ->\n    if Recorder.slots[s].buffer.loaded\n      if @slots[s].state is \"started\"\n        @slots[s].stop()\n      else \n        @slots[s].start()\n\n  toggleLooping : (s) ->\n    @slots[s].loop = not @slots[s].loop\n\n  toggleRecord : (s) ->\n    # if s is -1\n    #   @currentSlot = -1\n    if @recording\n      setbuttons @currentSlot, \"show\"\n      @stop()\n    else\n      @currentSlot = s\n      setbuttons @currentSlot, \"hide\"\n      @start()\n\n  cycleEffect : (s) ->\n    slot = @slots[s]\n    slot.disconnect slot.effect\n    slot.effect.dispose()\n    slot.effect = FX.create((slot.effect.index + 1) % FX.names.length, slot)\n    slot.connect slot.effect\n    slot.buffer.reverse = slot.effect.sign is \"<\"\n\n  getEffectValue : (s) ->\n    e = @slots[s].effect.index\n    fx = @slots[s].effect\n    fx.getVal()\n    \n  setEffect : (s, y) ->\n    s = Math.clamp(s, 0, Slots)\n    slot = @slots[s]\n    if slot.state is \"started\"\n      slot.effect.setVal y\n\n        \n      \n\n\n\n\n\nsetbuttons = (s, show) ->\n  for ss in [0..Slots-1]\n    if ss isnt s\n      $($(\"#buttons\").children()[ss])[show]()\n  for x in [1..4]\n    $($($(\"#buttons\").children()[s]).children()[x])[show]()\n    # $(\"#buttons:nth-child(#{s}):nth-child(#{x})\").hide()\n\nsetMasterButtons = (show) ->\n  for b in [1..3]\n    $($(\"#master\").children()[b])[show]()\n\n\ncheckstates = () ->\n  playing = false\n  for s in [0..Slots-1]\n    h = \"&empty;\"\n    if Recorder.slots[s].state is \"started\"\n      playing = true\n      h = \"&#x25a0;\"\n    else if Recorder.slots[s].buffer.loaded\n      h = \"&#x25b6;\"\n    $($($(\"#buttons\").children()[s]).children()[1]).html(h)\n  \n  # $($($(\"#phone\").children()[2]).children()[1]).html(if playing then \"&#x25a0;\" else \"&#x25b6;\")\n\nMouse =\n  down : false\n\ninit = () ->\n  slots = \n    for s in [0..Slots - 1]\n      record = $(\"<button>\", \n        html : \"&#x25cf;\"\n        # html : \"&nbsp&#x25cf;&nbsp\"\n        class :\"numpad, record\"\n        click : (e) ->\n          Tone.context.resume()\n          s = $(e.currentTarget).parent().index()\n          Recorder.toggleRecord(s)\n      )\n      play = $(\"<button>\", \n        html : \"\"\n        class :\"numpad, play\"\n        click : (e) ->\n          s = $(e.currentTarget).parent().index()\n          Recorder.currentSlot = s\n          Recorder.togglePlayer(s)\n      )\n      looper = $(\"<button>\", \n        html : \"&infin;\"\n        class :\"numpad, loop\"\n        click : (e) ->\n          s = $(e.currentTarget).parent().index()\n          Recorder.currentSlot = s\n          Recorder.toggleLooping(s)\n          $(@).html(if Recorder.slots[s].loop then \"&infin;\" else \"&#x21e5;\")\n      )\n      fx = $(\"<button>\", \n        html : \"%\"\n        class :\"numpad, effect\"\n        click : (e) ->\n          s = $(e.currentTarget).parent().index()\n          Recorder.currentSlot = s\n          Recorder.cycleEffect(s)\n          $(@).html(Recorder.slots[s].effect.sign)\n      )\n      buttons = [record, play, looper, fx]\n      $(\"<div>\",\n        class : \"buttonrow\"\n        html : buttons\n      )\n\n  $(\"#buttons\").html slots\n\n  volumeDown = $(\"<button>\", \n    html : \"-\"\n    class :\"numpad, masterbutton\"\n    click : (e) ->\n      Tone.Master.volume.value = Math.clamp(Tone.Master.volume.value - 1, -64, 12)\n  )\n  volumeUp = $(\"<button>\", \n    html : \"+\"\n    class :\"numpad, masterbutton\"\n    click : (e) ->\n      Tone.Master.volume.value = Math.clamp(Tone.Master.volume.value + 1, -64, 12)\n  )\n  mainrec = $(\"<button>\", \n    html : \"&#x25cf;\"\n    # html : \"&nbsp;\"\n    class :\"numpad, masterbutton, masterrecord\"\n    click : (e) ->\n      if MasterRecorder.isRecording()\n        MasterRecorder.finishRecording()\n        $(\"#master\").removeClass \"record\"\n        setMasterButtons \"show\"\n      else\n        MasterRecorder.startRecording()\n        $(\"#master\").addClass \"record\"\n        setMasterButtons \"hide\"\n  )\n  mainplay = $(\"<button>\", \n    html : \"&#x25b6;\"\n    class :\"numpad, masterbutton\"\n    click : (e) ->\n      playing = Recorder.slots.reduce(((a, v) -> if a then a else v.state is \"started\"), false)\n      for s in Recorder.slots\n        if s.buffer.loaded\n          if playing then s.stop() else s.start()        \n  )\n  muteonrec = $(\"<button>\", \n    html : \"h\"\n    class :\"numpad, masterbutton\"\n    click : (e) ->\n      Recorder.muteOnRec = not Recorder.muteOnRec\n      $(@).html(if Recorder.muteOnRec then \"f\" else \"h\")\n  )\n\n  master = $(\"<div>\",\n    class : \"buttonrow\"\n    id : \"master\"\n    html : [mainrec, muteonrec, volumeDown, volumeUp]\n  )\n\n  $(\"#phone\").append master\n\n  $(\"#screen\").on(\"touchstart mousedown\", () -> Mouse.down = true)\n  $(window).on(\"touchend mouseup\", () -> Mouse.down = false)\n\n  $(\"#screen\").on(\"touchmove mousemove\", (e) ->\n    if Mouse.down\n      $(\"#text\").html e.offsetX\n      w = Visual.ctx.canvas.width;\n      h = Visual.ctx.canvas.height;\n      x = e.offsetX\n      y = e.offsetY\n      Recorder.setEffect(Math.floor((x / w) * Slots), 1 - (y / h))\n  )\n\n  Visual.init()\n  Recorder.init()\n  MasterRecorder = new WebAudioRecorder(Tone.Master, workerDir : \"lib/\", encoding : \"mp3\")\n  MasterRecorder.onComplete = (rec, blob) ->\n    Recorder.saveFile(blob)\n  setInterval(checkstates, 100)\n\ninit()\n"
  ]
}